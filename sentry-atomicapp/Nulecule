---
specversion: 0.0.2
id: sentry-atomicapp

metadata:
  name: sentry Atomic App
  appversion: 1.0.0
  description: This is sentry

params:
  - name: db_user
    description: Database user
    default: sentry
  - name: db_pass
    description: Database password
    default: password
  - name: db_name
    description: Database name
    default: sentry
  - name: postgres_container_name
    desciption: Container name for postgresql
    default: postgres
  - name: postgres_container_image
    decription: Container image name for postgresql
    default: postgres
  - name: redis_container_name
    default: redis
  - name: redis_image_name
    default: redis
  - name: sentry_container_name
    default: sentry
  - name: sentry_image_name
    default: rtnpro/sentry
  - name: sentry_node_port
    default: 30001

graph:
  - name: postgresql
    params:
      name: $postgres_container_name
      image: $postgres_container_image
    artifacts:
      docker:
        - file://artifacts/docker/postgres
      kubernetes:
        - file://artifacts/kubernetes/postgres-pod.yaml
        - file://artifacts/kubernetes/postgres-service.yaml

  - name: redis
    params:
      name: $redis_container_naem
      image: $redis_image_name
    artifacts:
      docker:
        - file://artifacts/docker/redis
      kubernetes:
        - file://artifacts/kubernetes/redis-pod.yaml
        - file://artifacts/kubernetes/redis-service.yaml

  - name: sentry
    params:
      name: $sentry_container_name
      image: $sentry_image_name
      nodePort: $sentry_node_port
    artifacts:
      docker:
        - file://artifacts/docker/sentry
      kubernetes:
        - file://artifacts/kubernetes/sentry-pod.yaml
        - file://artifacts/kubernetes/sentry-service.yaml
